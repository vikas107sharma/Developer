# start nginx
vikas1141sharma@Vikass-MacBook-Pro ~ % nginx

# see what is running on given port
lsof -i :8080

# go to nginx folder
vikas1141sharma@Vikass-MacBook-Pro ~ %  ls /opt/homebrew/etc/nginx 

# open the config in vs code
vikas1141sharma@Vikass-MacBook-Pro ~ %  code /opt/homebrew/etc/nginx/nginx.conf



######################## nginx config ####################################

# Number of worker processes NGINX will spawn.
# Usually set to number of CPU cores for best throughput.
# `1` is fine for local/dev, NOT recommended for production.
worker_processes 1;

# Events block controls how NGINX handles connections
events {
    # Maximum number of simultaneous connections per worker process.
    # Total max connections â‰ˆ worker_processes * worker_connections
    worker_connections 1024;
}

http {
    # Load MIME type mappings so Content-Type headers are set correctly
    # Example: .js -> application/javascript, .json -> application/json
    include mime.types;

    # Defines a group of backend servers (Node.js instances)
    upstream nodejs_cluster {
        # Load-balancing strategy:
        # least_conn = send traffic to the backend with the fewest active connections
        # Better than round-robin for uneven request durations
        least_conn;

        # Backend Node.js servers
        server 127.0.0.1:5001;
        server 127.0.0.1:5002;
        server 127.0.0.1:5003;
    }

    # Virtual server definition
    server {
        # Port on which NGINX listens for incoming HTTP requests
        listen 8080;

        # Domain name this server responds to
        # localhost means it will match requests sent to localhost only
        server_name localhost;

        # Route all incoming requests starting with /
        location / {
            # Forward the request to the upstream cluster
            # NGINX acts as a reverse proxy here
            proxy_pass http://nodejs_cluster;

            # Preserve original Host header (important for virtual hosts, auth, cookies)
            proxy_set_header Host $host;

            # Pass the real client IP to the backend
            # Useful for logging, rate-limiting, auditing
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
}
